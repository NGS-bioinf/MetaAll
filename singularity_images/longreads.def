Bootstrap: library
From: ubuntu:22.04

%help 
	longreads container

%labels
	Author: asuljic 
	Maintained by: mbosilj

%environment
	LANG=C.UTF-8
	LC_ALL=C.UTF-8
	export LANG LC_ALL

%post
	apt-get -y update && apt-get -y upgrade
	apt autoremove
    apt install --fix-missing --install-recommends -y lsb-release curl wget apt-transport-https zlib1g-dev tar bzip2 gzip xz-utils unzip ca-certificates git perl make gcc libbz2-dev libssl-dev default-jdk default-jre

  	cd /opt
  	curl -L -O "https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-$(uname)-$(uname -m).sh"
  	bash Mambaforge-$(uname)-$(uname -m).sh -b -p /opt/mambaforge
  	. /opt/mambaforge/bin/activate

  	cd /opt
  	git clone https://github.com/marbl/Krona.git
  	cd Krona/KronaTools
  	mkdir taxonomy
  	./install.pl --prefix /opt/Krona/KronaTools     
  	bash updateTaxonomy.sh
  	bash updateAccessions.sh
    cd /opt
  	pip install nanopack
  	cd /opt
  	pip install networkx
  	cd /opt
  	pip install sniffles
  	cd /opt
  	git clone https://github.com/bonsai-team/Porechop_ABI.git
  	cd Porechop_ABI
  	python -m pip install .

  	mamba create -y -n longreads -c bioconda pip seqtk samtools flye porechop blast seqkit minimap2 bcftools bedtools quast gzip unzip krakenuniq krona diamond viralverify medaka

  	conda activate longreads

%environment
	export PATH=$PATH:/opt/mambaforge/envs/longreads/bin/
  	export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
  	export PATH=/opt/Krona/KronaTools/bin:$PATH
  	export PATH=$PATH:/opt/mambaforge/pkgs/
  	export PATH=$PATH:/opt/mambaforge/bin/
  	export PATH=$PATH:/opt/Porechop_ABI/
